<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>ØªÙ…ÙˆÙŠÙ†Ø§Øª Ø£Ø¨Ùˆ Ù…Ø§Ù„Ùƒ</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{font-family:tahoma;background:#f4f6f8;margin:0}
header{background:#2c3e50;color:#fff;padding:10px;text-align:center}
nav{display:flex;flex-wrap:wrap;background:#34495e}
nav button{flex:1;padding:10px;border:none;background:#34495e;color:#fff}
nav button:hover{background:#2c3e50}
section{display:none;padding:10px}
input,select,button{padding:6px;margin:4px;width:100%}
table{width:100%;border-collapse:collapse}
th,td{border:1px solid #ccc;padding:5px;text-align:center}
.profit{background:#27ae60;color:#fff;padding:10px;margin:5px}
.alert{color:red;font-weight:bold}
.camera-btn{width:40px}
</style>
</head>
<body>

<header>
<h2>ØªÙ…ÙˆÙŠÙ†Ø§Øª Ø£Ø¨Ùˆ Ù…Ø§Ù„Ùƒ Ù„Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„ØºØ°Ø§Ø¦ÙŠØ© ÙˆØ§Ù„Ø¨Ù‡Ø§Ø±Ø§Øª</h2>
<div class="profit">Ø§Ù„Ø±Ø¨Ø­ Ø§Ù„Ø­Ø§Ù„ÙŠ: <span id="profit">0</span> Ø±ÙŠØ§Ù„ ÙŠÙ…Ù†ÙŠ</div>
</header>

<nav>
<button onclick="openTab('sales')">Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</button>
<button onclick="secure('products')">Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</button>
<button onclick="secure('categories')">Ø§Ù„Ø£ØµÙ†Ø§Ù</button>
<button onclick="secure('units')">Ø§Ù„ÙˆØ­Ø¯Ø§Øª</button>
<button onclick="secure('reports')">Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</button>
<button onclick="secure('settings')">Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
</nav>

<!-- Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª -->
<section id="sales">
<h3>Ø¹Ù…Ù„ÙŠØ© Ø¨ÙŠØ¹</h3>
<input id="saleBarcode" placeholder="Ø¨Ø§Ø±ÙƒÙˆØ¯">
<button onclick="scan('saleBarcode')">ğŸ“·</button>
<input id="saleQty" type="number" placeholder="Ø§Ù„ÙƒÙ…ÙŠØ©">
<select id="salePay">
<option>Ù†Ù‚Ø¯Ø§</option><option>Ø¢Ø¬Ù„</option><option>Ø­ÙˆØ§Ù„Ø©</option>
</select>
<button onclick="addSale()">Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø¨ÙŠØ¹</button>
<div id="stockAlert"></div>
</section>

<!-- Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª -->
<section id="products">
<h3>Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬</h3>
<input id="pBarcode" placeholder="Ø¨Ø§Ø±ÙƒÙˆØ¯">
<button onclick="scan('pBarcode')">ğŸ“·</button>
<input id="pName" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬">
<select id="pCat"></select>
<select id="pUnit"></select>
<input id="pBuy" placeholder="Ø³Ø¹Ø± Ø§Ù„Ø´Ø±Ø§Ø¡">
<input id="pSell" placeholder="Ø³Ø¹Ø± Ø§Ù„Ø¨ÙŠØ¹">
<input id="pMin" placeholder="Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰">
<input id="pNote" placeholder="Ù…Ù„Ø§Ø­Ø¸Ø§Øª">
<button onclick="addProduct()">Ø­ÙØ¸</button>
<div id="productList"></div>
</section>

<!-- Ø§Ù„Ø£ØµÙ†Ø§Ù -->
<section id="categories">
<h3>Ø§Ù„Ø£ØµÙ†Ø§Ù</h3>
<input id="catName" placeholder="Ø§Ø³Ù… Ø§Ù„ØµÙ†Ù">
<button onclick="addCategory()">Ø¥Ø¶Ø§ÙØ©</button>
<div id="catList"></div>
</section>

<!-- Ø§Ù„ÙˆØ­Ø¯Ø§Øª -->
<section id="units">
<h3>ÙˆØ­Ø¯Ø§Øª Ø§Ù„Ù‚ÙŠØ§Ø³</h3>
<input id="unitName" placeholder="Ø§Ø³Ù… Ø§Ù„ÙˆØ­Ø¯Ø©">
<button onclick="addUnit()">Ø¥Ø¶Ø§ÙØ©</button>
<div id="unitList"></div>
</section>

<!-- Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± -->
<section id="reports">
<h3>Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø´Ù‡Ø±ÙŠ</h3>
<button onclick="print()">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø©</button>
<div id="report"></div>
</section>

<!-- Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª -->
<section id="settings">
<h3>Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</h3>
<input id="newPass" type="password" placeholder="ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø¬Ø¯ÙŠØ¯Ø©">
<button onclick="changePass()">ØªØºÙŠÙŠØ±</button>
<button onclick="backup()">Ù†Ø³Ø® Ø§Ø­ØªÙŠØ§Ø·ÙŠ</button>
<input type="file" onchange="restore(event)">
<button onclick="print()">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø©</button>
</section>

<script>
let db=JSON.parse(localStorage.getItem("db"))||{
products:[],cats:[],units:[],sales:[],profit:0,pass:"1234"
};
function save(){localStorage.setItem("db",JSON.stringify(db))}
function openTab(id){
document.querySelectorAll("section").forEach(s=>s.style.display="none");
document.getElementById(id).style.display="block";
}
openTab("sales");

function secure(id){
let p=prompt("ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±");
if(p===db.pass){openTab(id)}
}

function addCategory(){
db.cats.push(catName.value);save();render();
catName.value="";
}
function addUnit(){
db.units.push(unitName.value);save();render();
unitName.value="";
}

function addProduct(){
db.products.push({
barcode:pBarcode.value,name:pName.value,
cat:pCat.value,unit:pUnit.value,
buy:+pBuy.value,sell:+pSell.value,
min:+pMin.value,stock:0,note:pNote.value
});
save();render();
}

function addSale(){
let pr=db.products.find(p=>p.barcode===saleBarcode.value);
if(!pr)return alert("Ø§Ù„Ù…Ù†ØªØ¬ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯");
pr.stock-=saleQty.value;
let profit=(pr.sell-pr.buy)*saleQty.value;
db.profit+=profit;
db.sales.push({date:new Date(),barcode:pr.barcode,qty:saleQty.value});
save();render();
}

function render(){
profit.innerText=db.profit;
pCat.innerHTML=db.cats.map(c=>`<option>${c}</option>`).join("");
pUnit.innerHTML=db.units.map(u=>`<option>${u}</option>`).join("");
productList.innerHTML=db.products.map(p=>
`${p.name} | Ù…Ø®Ø²ÙˆÙ†:${p.stock} ${p.stock<=p.min?"<span class='alert'>âš ï¸</span>":""}`
).join("<br>");
}
render();

async function scan(id){
if(!("BarcodeDetector"in window))return alert("ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…");
let v=document.createElement("video");
let s=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}});
v.srcObject=s;v.play();
let d=new BarcodeDetector();
setTimeout(async()=>{
let b=await d.detect(v);
if(b.length)document.getElementById(id).value=b[0].rawValue;
s.getTracks()[0].stop();
},2000);
}

function backup(){
let a=document.createElement("a");
a.href=URL.createObjectURL(new Blob([JSON.stringify(db)]));
a.download="backup.json";a.click();
}
function restore(e){
let r=new FileReader();
r.onload=()=>{db=JSON.parse(r.result);save();render();}
r.readAsText(e.target.files[0]);
}
function changePass(){
db.pass=newPass.value;save();newPass.value="";
}
</script>
</body>
</html>
